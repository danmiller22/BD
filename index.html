<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diag — US Team Fleet</title>
  <style>
    body{margin:0;font:14px/1.4 system-ui,Segoe UI,Roboto,Arial;background:#0B0F1A;color:#E5E7EB;padding:24px}
    .ok{color:#34d399}.bad{color:#f87171}.box{padding:16px;border:1px solid #334; border-radius:12px;background:#111827}
    code{background:#111;padding:2px 6px;border-radius:6px}
  </style>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/umd/Recharts.min.js" defer></script>
</head>
<body>
  <h1>Diagnostics</h1>
  <div class="box" id="out">Проверка…</div>

  <script>
    const SHEET_ID="1QiFjfGky5vNBPf9WCPNkvszjJXH9413GecYzioSO32Q";
    const GID="1435752205";
    function line(name, ok, extra=""){
      return `<div>${name}: <b class="${ok?'ok':'bad'}">${ok?'OK':'FAIL'}</b> ${extra?`<code>${extra}</code>`:""}</div>`;
    }
    (async function(){
      const o=document.getElementById('out');
      const hasReact=!!window.React;
      const hasDOM=!!window.ReactDOM;
      const hasPapa=!!window.Papa;
      const hasRecharts=!!window.Recharts;

      let csvOK=false, note="";
      try{
        const urls=[
          `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&gid=${GID}`,
          `https://docs.google.com/spreadsheets/d/${SHEET_ID}/pub?gid=${GID}&single=true&output=csv`,
          `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`
        ];
        for(const u of urls){
          const r=await fetch(u,{mode:"cors",credentials:"omit",cache:"no-cache"});
          if(r.ok){
            const t=await r.text();
            if(t.trim()){ csvOK=true; note=`${new URL(u).pathname.split('/').pop()}`; break; }
          }
        }
      }catch(e){ note=e.message||String(e); }

      o.innerHTML =
        line("React",hasReact) +
        line("ReactDOM",hasDOM) +
        line("PapaParse",hasPapa) +
        line("Recharts",hasRecharts) +
        line("Google Sheet CSV",csvOK, note);

      console.log({hasReact,hasDOM,hasPapa,hasRecharts,csvOK,note});
    })();
  </script>
</body>
</html>
